<div class="content-wrapper liked-profile">
  <%= link_to root_path, class:"chevron-back-link" do %>
      <i class="fa fa-chevron-left"></i>
  <% end %>


  <h2>Music You've Liked</h2>
  <% if @user.opinions.count != 0%>
    <script>
      $ (function () {
      // Setup the player to autoplay the next track
        var a = audiojs.createAll({
          trackEnded: function () {
            var next = $('ol li.playing').next();
            if (!next.length)
              next = $('ol li').first();
            next.addClass('playing').siblings().removeClass('playing');
            audio.load($('a', next).attr('data-src'));
            audio.play();
          }
        });

      // Load in the first track
        var audio = a[0];
        first = $('ol a').attr('data-src');
        $('ol li').first().addClass('playing');
        audio.load(first);




      // Load in a track on click
        $('ol li').click(function (e) {
          e.preventDefault();
          $(this).addClass('playing').siblings().removeClass('playing');
          audio.load($('a', this).attr('data-src'));
          audio.play();
        });


        // prevent click on profile button inside LI from also starting audio
        $('.likes-profile-button').click(function (e) {
          event.stopPropagation();
        });


      });
    </script>
    <div class="dashboard-music-player">


      <div id="wrapper" class="likes-page-music-player">
        <audio preload></audio>
        <ol class="likes-page-song-titles">
          <% @user.opinions.each do |opinion| %>
            <% if opinion.positive == true %>

              <li>



                <div class="clip-info">
                 <%= opinion.clip.instrument ? "" + opinion.clip.instrument.name : () %>
                 <%= opinion.clip.genre ? "<br />" + opinion.clip.genre : () %>

                 <br />
                 <%= opinion.clip.title ? opinion.clip.title : opinion.clip.uploaded_file_file_name %>

                  <br />
                  <i class="fa fa-play-circle"></i>
                </div>



                  <div class="likes-left">



                    <div class="user-info">

                      <%= link_to user_path(opinion.clip.user.id), method: 'get', class:"profile-button" do %>


<span style="font-style:italic;"><%= opinion.clip.user.name %> </span>

                      <% unless @user.profile_picture.blank? %>
                         <%= image_tag @user.profile_picture.url, class:"profile-pic" %>
                       <% else %>
                         <%= image_tag "default_profile_pic.jpg", class:"profile-pic" %>
                       <% end %>

<span style="font-style:italic;">View Profile</span>

                      <% end %>
                      <!--
                      <%= link_to 'View Profile', user_path(opinion.clip.user.id), method: 'get', class:"profile-button" %>-->
                    </div>


                  </div>












<!--
                <a href="#" data-src='<%= opinion.clip.uploaded_file %>'>

              </a>
-->


             </li>


            <% end %>
          <% end %>
        </ol>
      </div>
    </div>

  <% else %>

  <div class="dashboard-music-player">
    <p> No Likes yet! <br /><br />
       Go <%= link_to 'Search', search_path %> for musicians <br />
       to change this! </p>
  </div>

  <% end %>

</div>
